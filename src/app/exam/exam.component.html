
 
<div *ngIf="loading" class="loading">Chargement de l'examen...</div>

<div *ngIf="error" class="error">{{ error }}</div>
-->

<section *ngIf="currentSection === 'geolocation'" class="geolocation-section">
  <h2>Activation de la géolocalisation</h2>
  <p>Vous devez activer la géolocalisation pour passer cet examen.</p>
  <button (click)="enableGeolocation()">Activer la géolocalisation</button>
  <p *ngIf="error" class="error">{{ error }}</p>
</section>

<section *ngIf="currentSection === 'intro'" class="intro-section">
  <h2>{{ examData?.title }}</h2>
  <p>{{ examData?.description }}</p>
  <p><strong>Public cible:</strong> {{ examData?.publicCible }}</p>
  <p><strong>Nombre de questions:</strong> {{ questions.length }}</p>
  <button (click)="startExam()">Commencer l'examen</button>
</section>


<section *ngIf="currentSection === 'question'" class="question-section">
  <div class="exam-header">
    <div id="questionCounter">Question {{ currentQuestionIndex + 1 }}/{{ questions.length }}</div>
    <div id="questionTimer">00:00</div>
    <div id="globalTimer">{{ formatTime(globalTimeElapsed) }}</div>
  </div>

  <div class="question-content">
    <h3>{{ questions[currentQuestionIndex]?.questionText }}</h3>

    <form [formGroup]="answerForm">
      <div *ngIf="questions[currentQuestionIndex]?.questionType === 'direct'">
        <input type="text" formControlName="directAnswer" placeholder="Entrez votre réponse ici...">
      </div>
    </form>

    <div *ngIf="questions[currentQuestionIndex]?.questionType === 'qcm'">
      <ul class="qcm-options">
        <li *ngFor="let option of questions[currentQuestionIndex]?.qcmOptions; let i = index" 
            [class.selected]="answers[currentQuestionIndex].selectedOptions.includes(option.optionText)"
            (click)="toggleOption(option.optionText)">
          <input type="checkbox" [id]="'option-' + currentQuestionIndex + '-' + i" 
                 [checked]="answers[currentQuestionIndex].selectedOptions.includes(option.optionText)"
                 (click)="$event.stopPropagation()">
          <label [for]="'option-' + currentQuestionIndex + '-' + i">{{ option.optionText }}</label>
        </li>
      </ul>
    </div>
  </div>

  <div class="navigation-buttons">
    <button (click)="prevQuestion()" [disabled]="currentQuestionIndex === 0">Question précédente</button>
    <button *ngIf="currentQuestionIndex < questions.length - 1" (click)="nextQuestion()">Question suivante</button>
    <button *ngIf="currentQuestionIndex === questions.length - 1" (click)="submitExam()">Soumettre l'examen</button>
  </div>
</section>


<section *ngIf="currentSection === 'results'" class="results-section">
  <h2>Résultats de l'examen</h2>
  <div class="score-display">
    <p>Votre score: <span id="finalScore">{{ finalScore }}</span>/100</p>
    <p id="scoreMessage" [style.color]="scoreMessageColor">{{ scoreMessage }}</p>
</div>
  <div class="exam-details">
    <p><strong>Localisation:</strong> <span id="locationDetails">
      {{ location ? (location.latitude.toFixed(4) + ', ' + location.longitude.toFixed(4)) : 'Non disponible' }}
    </span></p>
    <p><strong>Temps total:</strong> <span id="totalTime">{{ formatTime(globalTimeElapsed) }}</span></p>
  </div>
  <button (click)="returnHome()">Retour à l'accueil</button>
</section>

